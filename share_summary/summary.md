2寄存器的低八位设置为1，接下来将R2的高八位设置为0
这样我们的R2就有了一个完整个的值。同理我们也对R0和R1寄存器赋值
，由于我们要在FPGA实验板上实现LED流水灯效果，所以我们将R1的值输出的端口，然后R1的值左移，相当于八个LED灯的第二个灯亮了，紧着这我们将R3赋值为0，然后我们要进入一个循环相当于while，这是起一个延时的作用，否则观察不到led灯的流水变化，这里是直到R3-R2位0时我们才让led灯的下一个灯亮，最后当一轮循环过后，我们又让第一个灯亮，如此循环下去。

我们将这些指令存入RAM中：

![](https://i.imgur.com/ZmXnLTD.png)

通过这一章的学习，我们要了解机器码的表示。


## 第四章：处理器体系结构 ##

在这一章，我们需要了解处理器的基本结构及工作原理。

基本结构如图所示：

![](https://i.imgur.com/GMoEJYw.png)

![](https://i.imgur.com/8hwfuDf.png)

数据通路是每个功能部件进行信息传递的通路，控制通路下的状态机是控制高低电平，即每个器件随着CLK的变换应该变为什么状态。

我讲解一下寻址单元，如图：

![](https://i.imgur.com/ZHxiRpU.png)


寻址单元有Programmer Counter和Address Logic组成，主要用于根据控制单元发出的控制信号生成相应的地址值，用于后续到存储器相对应的地址处读取数据，PC 模块相当于一个地址锁存器，AL 模块用于做地址的逻辑运算。其中PC是一个时序电路，因为它有一个CLK端，AL是一个组合逻辑电路，就是说只有在时钟上升沿PC才会更新值，而AL只要接收到值就会进行计算。具体的参数如图：

![](https://i.imgur.com/c8qT8OC.png)

在CPU中，指令是按流水线执行的，这样我们在较少的时钟周期就能计算一条指令，效率高。如果分的级数越多，那么我们就能在更短的时间里计算一条指令，但是并不是级数越多越好，因为随着级数的增多，你在一个时钟周期里所要做的无用功更多，性能无法得到更大的提升，随之而来的我们就诞生出了多核处理器。还有一种超标量流水线的技术，相当于在一个时间点，计算出多条指令，吞吐量更大，但是如果两条指令有数据相关，那么他将无法在同一时刻完成两条指令的运算。

CPU在执行指令是并不一定按照顺序来执行，可能遇到跳转指令就进行了跳转，有一种分支预测的技术来提高的预测的命中率，如果跳转到了错误的地方，就会浪费很多时间周期。

在这一章中，我们需要学习处理器的基本结构，并且了解其工作原理，有助于我们更深入的理解计算机系统。

## 第五章：优化程序性能 ##

在这一章，我们要学习如何对我们的程序进行优化。
书中给出了一写算法的例子来说明合适的算法有助于我们程序进行优化。
。我们要尽量减少过程的调用，因为每调用一次函数，程序就要进行现场的保护和恢复，这将带来不小的开销。正如上一节我们说的，我们需要了解处理器的工作原理，这将帮助我们编写符合CPU工作原理的代码，如CPU里的高速缓存，CPU从里面获取数据的速度更快，而从硬盘里获取数据的速度更慢，这就给了我们一些提示。然后，我们需要提高程序的并行性，这将加速程序的运行速度。

总之，我们要把握好一下几个点：

1、减少过程调用

2、理解现代处理器

3、理解内存性能

4、提高并行性



## 第六章：存储器层次结构 ##

存储器系统是一个具有不同容量、成本和访问时间的存储设备的层次结构。CPU寄存器保存着最常用的数据。靠近CPU的小的、快速的高速缓存存储器作为一部分存储在相对慢速的主存储器中数据和指令的缓冲区域。主存缓存存储在容量较大的、慢速磁盘上的数据，而这些磁盘常常又作为存储在通过网络连接的其他机器的磁盘或磁带上的数据的缓冲区域。所以缓存是一个相对的概念。

我们需要理解存储器的层次结构，因为它对应用程序的性能有着巨大的影响。如果你的程序是存储在CPU寄存器中的，那么在指令的执行期间，在0个周期就能够访问到他们。如果存储在高速缓存中，则需要4~75个周期。

存储器的层次结构图：

![](https://i.imgur.com/nisQcWO.png)

接着，我们需要了解局部性的概念，良好的计算机程序具有良好的局部性。
局部性有两种不同的形式：时间局部性和空间局部性。时间局部性是指被引用过一次的内存位置很可能在不远的将来再被多次引用。空间局部性是指如果一个内存位置被引用了一次，那么程序很可能在不远的将来引用附近的一个内存位置。局部性的原理正是体现了高速缓存的存储结构。


## 第七章：链接 ##
链接是将各种代码和数据片段收集并组合成为一个单一文件的过程，这个文件可被加载到内存并执行。链接能让我们的程序分成很多小块，最后链接将他们合到一起，方便与我们编写程序。

静态链接：

为了构造可执行文件，链接器必须完成两个主要任务：

1、符号解析

2、重定位


链接器读取一组可重定位的目标文件，将他们链接起来，形成一个输出的可执行文件，我们又称为静态库。当程序运行时，我们需要引入静态库的内容。这种方法的缺点是每个可执行文件都包含静态库的完全副本，所以将会对磁盘空间造成浪费。


动态链接共享库：

上面我们提到程序引入静态库会造成空间浪费，动态链接共享库就解决了这个问题。所有引用该库的可执行目标文件共享这个库中的代码和数据，而不是将他们复制到可执行文件中。


## 第八章：异常控制流 ##

异常的类别：中断、陷阱、故障和终止

中断是来自处理器外部的I/O设备的信号的结果，是异步发生的，如键盘可以向处理器芯片上的一个引脚发信号，告诉处理器有中断发生并处理它。

陷阱是因为程序中有系统调用，程序有用户态陷入到内核态。

故障有错误引起，他能被故障处理程序修正。

终止是不可恢复的致命错误造成的结果，通常是一些硬件错误。

### 进程 ###

首先我们需要知道进程的概念：进程是可并发执行的程序在给定数据集合上的一次执行过程；是系统进行资源分配和调度的一个独立的基本单位和实体；是指执行一个映象程序的总环境。

我们不妨将程序与进程比较一下：

1、程序是指令的集合，是静态概念

进程是程序的执行过程，是动态概念

2、程序可作为软件资源长期保存

进程只是一次短暂活动或过程

3、一个程序可对应多个进程

一个进程可包含多段程序



进程有如下特征：

动态性：具备生命周期，可以被建立、挂起、撤销

并发性：进程执行时间重叠

独立性：资源分配的基本单位，相对独立

异步性：速度不可预知， “走走停停”


我们用PCB来存放进程的相关信息：

![](https://i.imgur.com/rqdPo5J.png)



进程有三种基本状态：

就绪状态：获得了除了CPU外的一切所需资源，具备执行条件

执行状态：占有CPU，正在执行。

等待状态：因等待某种事件而暂时不能执行


附上状态转换图：
![](https://i.imgur.com/BCAfJLE.png)

### 进程的调度 ###
进程的调度是为了使每个进程都能合理的使用处理机，并得到及时的响应，
控制协调进程对CPU的竞争。

进程调度的发生可能有以下的原因：

1、进程执行完毕

2、进程等待某个事件阻塞

3、进程的时间片用完

4、有新进程（高优先级）进入就绪队列
/bin/bash: multiple-cursors-apply: 未找到命令
/bin/bash: multiple-cursors-apply: 未找到命令
/bin/bash: multiple-cursors-apply: 未找到命令
