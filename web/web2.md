# HTTP协议 #

## 协议简介 ##
HTTP协议(**超文本转移协议**)是属于OSI七层协议中的应用层, 它通常是基于TCP协议而运作的，默认端口为80（就是传输层和应用层之间的SAP）,并且它是无状态、无连接的协议。正因为HTTP是无状态的协议，所以后面才会出现Cookie和Session。http协议是基于文本的，所以它能方便我们读懂协议本身。

## 交互过程 ##

![](https://i.imgur.com/gEQL5qX.png) 
我们可以从上图中可以看出，客户端向服务端发出HTTP请求，然后服务端接收请求并向服务端返回HTTP响应。

![](https://i.imgur.com/DbFEhRf.png)
从上图我们可以知道，应用层中的数据是经过层层封装发送给服务端，服务端再经过层层解封得到数据。


## HTTP请求 ##
发出一次HTTP请求时，我们得知道我们所要的资源在哪个位置，并且用什么方法请求。
URL可以帮助我们定位资源。
![](https://i.imgur.com/L5G45YB.png)

请求方法有如下几种:

![](https://i.imgur.com/FAf1vnK.png)

最后我们需要加上头部交给下一层，格式如下:

![](https://i.imgur.com/UJvtUl8.png)


## HTTP响应 ##

在服务端接收到HTTP请求后，它需要作出响应，它需要告知客户端此次访问的状态如何以及决定把什么资源交给客户端。状态码就是告知客户端此次的HTTP请求状态如何:
![](https://i.imgur.com/Jo29jgv.png)
最后加上头部，格式如下:
![](https://i.imgur.com/r1Vr9bA.png)

## HTTP1.1缺陷 ##

1、基于明文文本的通信内容可能被窃听  
2、不验证通信双方的身份可能遭伪装  
3、无法证明报文完整性可能遭篡改
4、一条连接上只可发一个请求  
5、队头阻塞  
6、请求只能由客户端发起，客户端不可接受响应之外的指令   
7、请求和响应的首部未经压缩就发送，首部信息越多延迟越大  
8、发送冗长的首部，多次来回之间首部大部分字段都未改变，浪费资源  
9、可选择任意压缩格式，不强制压缩后发送  


## HTTP2.0 ##
HTTP2.0针对HTTP1.1的缺陷作出了一些优化，这里我只介绍我觉得比较重要且有意义的。  

### 二进制分帧 ###
HTTP/2 将 HTTP 协议通信分解为二进制编码帧的交换，这些帧对应着特定数据流中的消息。所有这些
都在一个 TCP 连接内复用。这是 HTTP/2 协议所有其他功能和性能优化的基础。

![](https://i.imgur.com/xcVQjqp.png)

但是这样做导致的结果可能是，发送的帧是乱序的，那么服务端就要进行等待更多的帧来进行组合（除非是发送时是有序的，才可以边接收边组合），如果中途出现帧丢失，那么延迟会更长。


### 管线化请求 ###

HTTP1.1的请求方式是停等式，就是发出一个请求要等待响应才能发送下一个请求。管线化请求和数据链路层的滑动窗口类似，就是说我们不必等待上一次的请求响应而继续接着发下一个请求，这样传输的效率就会变高。

### 流控制 ###
流控制就是避免发送方的发送速度过快而淹没了接收方，有了这种机制，如果接收方认为发送速度过快时，它可以反馈给发送方，让发送方降低速度。

## 其他 ##
其实HTTP2.0做的这些优化有很多都和底层协议类似，虽然他们所处的层级不同，但是他们所处理的是通信双方的收发过程，所以很多技术的原理都相同。
